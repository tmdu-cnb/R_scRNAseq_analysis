# FindAllMarkers結果の読み方ガイド

## 結果ファイルの構造

FindAllMarkersの結果には以下の列が含まれています：

| 列名 | 説明 | 例 |
|------|------|-----|
| **gene** | 遺伝子名 | Cbln3, Rims1, Itpr1 |
| **cluster** | どのクラスターのマーカーか | 0, 1, 2, ... |
| **avg_log2FC** | 平均log2 fold change | 1.07, 0.94, -0.65 |
| **p_val** | p値（統計的有意性） | 6.56e-18 |
| **p_val_adj** | 調整済みp値（多重比較補正後） | 1.25e-13 |
| **pct.1** | そのクラスターでの発現細胞割合（0-1） | 0.861 (86.1%) |
| **pct.2** | 他のクラスターでの発現細胞割合（0-1） | 0.599 (59.9%) |

## マーカー遺伝子の判断基準

**マーカー遺伝子**とは、特定のクラスターで特異的に発現している遺伝子です。

### 1. avg_log2FC（平均log2 fold change）
- **意味**: そのクラスターでの発現が他のクラスターよりどれだけ高いか
- **解釈**:
  - `avg_log2FC > 0`: そのクラスターでより多く発現（正のマーカー）
  - `avg_log2FC < 0`: そのクラスターでより少なく発現（負のマーカー）
  - `avg_log2FC = 1.0`: 約2倍高い発現
  - `avg_log2FC = 2.0`: 約4倍高い発現
- **閾値**: この解析では `avg_log2FC > 0.25` を設定

### 2. p_val_adj（調整済みp値）
- **意味**: 統計的有意性（多重比較補正後）
- **解釈**:
  - `p_val_adj < 0.05`: 統計的に有意（マーカーとして信頼できる）
  - `p_val_adj < 0.01`: より有意
  - `p_val_adj < 0.001`: 非常に有意
- **推奨閾値**: `p_val_adj < 0.05`

### 3. pct.1 と pct.2（発現細胞割合）
- **pct.1**: そのクラスターでの発現細胞割合
- **pct.2**: 他のクラスターでの発現細胞割合
- **解釈**:
  - `pct.1 > pct.2`: そのクラスターでより多く発現（良いマーカー）
  - `pct.1 = 0.9, pct.2 = 0.3`: そのクラスターの90%で発現、他のクラスターの30%で発現 → 非常に良いマーカー

## マーカー遺伝子の選び方

### 良いマーカー遺伝子の条件：
1. ✅ `avg_log2FC > 0.25`（設定した閾値以上）
2. ✅ `p_val_adj < 0.05`（統計的有意性）
3. ✅ `pct.1 > pct.2`（そのクラスターでより多く発現）
4. ✅ `pct.1`が高い（そのクラスターの多くの細胞で発現）

### 例：Cbln3遺伝子（Cluster 0のマーカー）
```
gene: Cbln3
cluster: 0
avg_log2FC: 1.07
p_val_adj: 1.25e-13
pct.1: 0.861 (86.1%)
pct.2: 0.599 (59.9%)
```

**解釈**:
- `avg_log2FC = 1.07` → Cluster 0で他のクラスターより約2倍発現が高い ✅
- `p_val_adj = 1.25e-13` → 非常に統計的に有意 ✅
- `pct.1 = 0.861` → Cluster 0の86.1%の細胞で発現 ✅
- `pct.2 = 0.599` → 他のクラスターの59.9%で発現
- **結論**: Cbln3はCluster 0の良いマーカー遺伝子

## 結果ファイルの使い方

### Excelファイル（FindAllMarkers_結果_クラスター別.xlsx）
- 各クラスターごとにシートが分かれています
- 例: `DTA_Cluster_0`, `DTA_Cluster_1`, ...
- 各シートは`avg_log2FC`の降順でソートされています（上位が良いマーカー）

### CSVファイル（FindAllMarkers_DTA_結果.csv）
- 全クラスターの結果が1つのファイルにまとまっています
- フィルタリングして使用:
  ```r
  # Rでの例
  library(dplyr)
  markers <- read.csv("FindAllMarkers_DTA_結果.csv")
  
  # Cluster 0の上位10マーカー
  cluster0_top10 <- markers %>%
    filter(cluster == "0", p_val_adj < 0.05, avg_log2FC > 0.25) %>%
    arrange(desc(avg_log2FC)) %>%
    head(10)
  ```

## 実用的な使い方

### 1. クラスターの同定
各クラスターの上位マーカー遺伝子を見て、どの細胞型かを判断：
- `Rims1`, `Grm4`, `Gabra6` → Granule cells
- `Itpr1`, `Calb1`, `Car8` → Purkinje cells
- `Tubb2b`, `Aqp4` → Bergmann glia

### 2. マーカー遺伝子の選定
- `avg_log2FC`が高い順に並べる
- `p_val_adj < 0.05`でフィルタリング
- `pct.1`が高いものを優先

### 3. 文献マーカーとの比較
この解析では、文献ベースのマーカー遺伝子の87%がFindAllMarkersでも検出されました。

## よくある質問

**Q: avg_log2FCが負の値の遺伝子は？**
A: そのクラスターで「発現が低い」ことを示すマーカーです。そのクラスターに「ない」ことを示す指標として使えます。

**Q: どのくらいのマーカー遺伝子を選べばいい？**
A: クラスターの同定には、上位5-10個のマーカー遺伝子で十分です。

**Q: p_valとp_val_adjの違いは？**
A: `p_val_adj`は多重比較補正後の値で、より厳しい基準です。通常は`p_val_adj`を使用します。






